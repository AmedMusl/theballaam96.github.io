<html>
	<head>
		<title>DK64 Practice ROM - Donkey Kong 64 Speedruns</title>
		<link rel="stylesheet" href="style/nav.css">
		<link rel="stylesheet" href="style/main.css">
		<link rel="stylesheet" href="style/home.css">
		<link rel="stylesheet" href="style/maps.css">
		<link rel="stylesheet" href="style/mj.css">
		<meta name="description" content="" />
		<style>
			.homebox {
				transition: 0.5s ease-in-out;
				cursor: default;
			}
			.homebox.clickable:hover {
				border-color:red;
			}
			.changelog.container {
				color: white;
				padding-top: 10px;
				padding-left: 20px;
			}
			.changelog.version {
				font-weight: bold;
			}
			.changelog.warning {
				padding-top: 5px;
				padding-bottom: 5px;
				color: red;
			}
			.changelog.asmHeader {
				font-weight: bold;
				margin-top: 10px;
			}
			.changelog.docbox {
				padding: 10px;
			}
			.buttoncontainer {
				padding: 10px;
				flex: 33%;
			}
			.ytcontainer {
				margin-left: auto;
				margin-right: auto;
				width: fit-content;
				padding: 15px;
			}
			.sidebutton_container {
				padding: 5px;
			}
			.asm.pad {
				height: 15px;
			}
			.asm.label {
				color: darkcyan;
			}
			.asm.comment {
				color: gainsboro;
			}
			.asm.func {
				color: firebrick;
			}
			.asm.param {
				color: orange;
			}
			.asm.hex {
				color: mediumaquamarine;
			}
			.asm.pointer {
				color: cornflowerblue;
			}
			.asm.array {
				color: salmon;
			}
			.asm.first {
				padding-left: 50px;
			}
			.excluded_link {
				color: darkgoldenrod;
			}
		</style>
	</head>
	<body>
		<nav id="navigation"></nav>
		<div class="v_spacer">
		</div>
		<div class="flexsplitter">
			<div class="homebox">
				<div class="header master_header">
					<strong>Donkey Kong 64 Practice ROM</strong>
				</div>
			</div>
		</div>
		<div class="flexsplitter">
			<div class="homebox" style="flex:80%">
				<div class="changelog container infoContainer" box="feature_list">
					<div class="changelog version">
						Features list
					</div>
					<ul>
						<li>Quality of life features</li>
						<ul>
							
							<li>Story Skip locked to on</li>
							<li>Entire Mystery Menu unlocked from the start</li>
						</ul>
						<li>Tag Anywhere with D-Down</li>
						<li>D-Up on the pause menu main screen to access more functions</li>
						<ul>
							<li>Option to warp to the following levels</li>
							<ul>
								<li>The primary 7 levels</li>
								<li>DK Isles</li>
								<li>Hideout Helm</li>
								<li>The 5 phases of K. Rool</li>
							</ul>
							<li>Store permanent flags to load later. When you load, it warps you to the map you stored the savestate in, from the entrance that you entered that map from, with the kong you were when you stored the state</li>
							<li>Option to toggle some late game moves</li>
							<ul>
								<li>Toggle between the 4 levels of 'Simian Slam'</li>
								<ul>
									<li>No Slam</li>
									<li>Simian Slam</li>
									<li>Super Simian Slam</li>
									<li>Super Duper Simian Slam</li>
								</ul>
								<li>Toggle 'Sniper Scope' on or off</li>
							</ul>
							<li>Option to display various Statistics</li>
							<ul>
								<li>These are the following statistics you can display:</li>
								<ul>
									<li>Lagometer</li>
									<li>Lagometer (Cumulative)</li>
									<ul>
										<li>Press L to reset to 0</li>
									</ul>
									<li>Intro Story Timer</li>
									<li>Speed</li>
									<li>Timer</li>
									<ul>
										<li>Timer is displayed in frames, where there are 60 frames that occur each second (whether they are lag frames or not)</li>
										<li>L to Start timer. Press again to stop timer. Press again to reset timer back to 0</li>
									</ul>
								</ul>
								<li>This shows under all circumstances except when something else covers the lagometer (like the transition spin)</li>
								<li>If you are in K Rool, and the Lagometer is on, the K. Rool timer will shift to the right side of the screen</li>
							</ul>
							<li>Option to set up the flags necessary to practice "Takeoff Skip"</li>
							<ul>
								<li>Sets all "Key turned in" flags (excl. Key 3 & 8)</li>
								<li>Clears the "Key 3 turned in" and "Key 8 turned in" flags</li>
								<li>Sets the flags for having Keys 3 & 8</li>
								<li>Clears Rainbow Coin First Time Text flag</li>
								<li>Clears the flag for having acquired the Rainbow Coin behind K. Lumsy</li>
							</ul>
							<li>Option to grant all moves and kongs</li>
							<li>Option to restock inventory items (eg. Crystals, Oranges)</li>
							<li>Option to gift the player 50 coins to all kongs to enable easy purchase of a particular set of moves</li>
						</ul>
						<li>Position Warping</li>
						<ul>
							<li>D-Right to store a position</li>
							<li>D-Left to warp to that stored position, if you are on the same map you stored the position in</li>
							<li>Various stats will also be stored with this:</li>
							<ul>
								<li>Your X, Y and Z co-ordinates</li>
								<li>Your "Stored Position" (in the context of TBS)</li>
								<li>Your facing angle</li>
								<li>Your Z Rotation (AKA "Skew angle")</li>
								<li>Your velocity & acceleration both horizontally and vertically</li>
								<li>Your floor height</li>
							</ul>
						</ul>
					</ul>
				</div>
				<div class="changelog container infoContainer hide" box="installation_guide">
					<div class="changelog version">
						Installation guide
					</div>
					<ol>
						<li>If you intend to use this on N64, you will need an N64 everdrive (v2.5 or higher)</li>
						<ul>
							<li>Emulators are not great with DK64 ROM Hacks right now. <a class="excluded_link" href="https://github.com/Isotarge/ScriptHawk">ScriptHawk</a> & <a class="excluded_link" href="http://tasvideos.org/Bizhawk.html">BizHawk's</a> 10 savestates provide ample support for anything the ROM Hack could provide</li>
						</ul>
						<li>You will need a ROM of the US Version of Donkey Kong 64</li>
						<ul>
							<li>I will not provide you this. You will need to go about this yourself</li>
							<li>The ROM will need to have the following ROM Hash</li>
							<ul>
								<li>SHA1: CF806FF2603640A748FCA5026DED28802F1F4A50</li>
							</ul>
							<li>The PAL, JP and Kiosk versions will not work with the ROM yet</li>
						</ul>
						<li>With either <a class="excluded_link" href="https://www.romhacking.net/utilities/893/">Beat (N64 Only)</a> or <a class="excluded_link" href="https://www.romhacking.net/utilities/240/">Lunar IPS</a>, patch in the practice ROM. You will only need to download one patch file, which one depends on the patching program you are using</li>
						<ul>
							<li>For Beat</li>
							<ol>
								<li>Select <em>"Apply Patch"</em></li>
								<li>Select the .bps file as the patch file</li>
								<li>Select the .z64 DK64 ROM as the original file</li>
								<li>Enter a file save location for your practice rom .z64 file</li>
								<li>Click <em>"Apply"</em></li>
							</ol>
							<li>For Lunar IPS</li>
							<ol>
								<li>Select <em>"Apply IPS Patch"</em></li>
								<li>Select the .ips file as the patch file</li>
								<li>Select the .z64 DK64 ROM as the original file</li>
								<li>Enter a file save location for your practice rom .z64 file</li>
							</ol>
						</ul>
					</ol>
					<strong>The next section is for Wii U only</strong>
					<ol>
						<li>Homebrew your Nintendo Wii U. Tutorials for how to do so can be found <a class="excluded_link" href="https://www.youtube.com/watch?v=LW5QVxAlDoY">here</a> and <a class="excluded_link" href="https://www.youtube.com/watch?v=3-qnzaxL7Bg">here</a></li>
						<li>Open <a class="excluded_link" href="https://gbatemp.net/threads/release-phacoxs-injector-nes-snes-n64-gba-nds-for-wii-u.554521/">PhacoxsInjector</a></li>
						<li>Click "Choose" and select your modified ROM that has been converted with any of the above methods</li>
						<li>Click "Load Base" and select the <a class="excluded_link" href="https://www.youtube.com/watch?v=B7xxMJIFK8M">DK64 Base</a></li>
						<li>Go to Config file and select the <a class="excluded_link" href="http://phacoxcll.blogspot.com/2019/09/archivos-ini-de-la-consola-virtual-de.html">.ini file</a></li>
						<li>Add the Wii U "Common Key", which can be found with a Google search</li>
						<li>Go to injecting and select "Do pack" to start the injection</li>
						<li>Select the install folder on your FAT32 SD Card. Your SD card will also need the following folders correctly set up:</li>
						<ul>
							<li>apps</li>
							<li>hax chi</li>
							<li>Nintendo</li>
							<li>saves</li>
							<li>wiiu</li>
						</ul>
						<li>Insert the SD Card into your Wii U</li>
						<li>Select the Haxchi app on your Wii U. Hold A or B to use custom firmware, then go to "WUP Installer"</li>
						<li>Select the name of your hack, and click "Install"</li>
						<li>Select NAND</li>
						<li>Go back to the Wii U Menu to run the injected hack</li>
					</ol>
				</div>
				<div class="changelog container infoContainer ytcontainer hide" box="trailer">
					<iframe width="560" height="315" src="https://www.youtube.com/embed/6bliW6-loGY" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
				</div>
				<div class="changelog container infoContainer hide" box="documentation">
					<div class="changelog version">
						Assembler Documentation
					</div>
					<div class="changelog docbox" asm="changecolour">
						<div class="changelog asmHeader">
							Change Kong Colour
						</div>
						<div class="asmcode">
								ChangeColour:
									SW 		$ra, @ReturnAddress
									LUI  		$a0, 0x8069	
									SB 		$r0, 0xA62F($a0) // 0x8068A62F // Enable colouring for 1-player gameplay
									SW 		$r0, 0xA450($a0) // 0x8068A450 // Cancel the call of a function which changes the player model to a low poly version
									JAL 		0x8068A508 // Adjust player colour function
									SW 		$r0, 0xA458($a0) // 0x8068A458 // Cancel a variable write that relies on the earlier function call. Would crash otherwise
									LA 		$a0, KongColours // Kong Colours is an array of assigned colour indexes for each kong
									LBU 		$a1, @Character // Character is an address which indicates kong value, where 0 is DK, 1 is Diddy (...) and 4 is Chunky
									ADD 		$a0, $a0, $a1
									LBU 		$a1, 0x0 ($a0)
									SW 		$a1, @PlayerOneColour // Player's colour is controlled by Player 1 colour address (US: 0x807552F4)
									LW 		$ra, @ReturnAddress
									JR 		$ra
									NOP

								.align
								KongColours:
									.byte 	0x02 // DK - Green Body
									.byte 	0x02 // Diddy - Yellow Cap
									.byte 	0x01 // Lanky - Green Straps
									.byte 	0x02 // Tiny - Purple Suit
									.byte 	0x01 // Chunky - Red Suit
						</div>
					</div>
					<div class="changelog docbox" asm="saveflagblock">
						<div class="changelog asmHeader">
							Save Flag Block
						</div>
						<div class="asmcode">
							SaveFlags:
								SW 		$ra, @ReturnAddress
								JAL 	@GetFlagBlockAddress // Grabs the flag block address (US: 0x8060E25C)
								ADDIU 	$a0, $r0, 0 // Flag Type 0 (Permanent)
								LI 		$a0, 0x13C // Permanent flag block limit, 0x13C bytes
								ADDIU 	$a3, $v0, 0 // The output address of GetFlagBlockAddress is v0. Copy to a3 for manipulation
								LI 		$a1, @SavedPermanentFlags // SavedPermanentFlags would be wherever you are saving your flag block to

									ReadFlags:
										LW 		$a2, 0x0($a3) // Loads 4-byte value in the flag block into $a2 register
										SW 		$a2, 0x0($a1) // Stores 4-byte value in save location 
										BEQZ 	$a0, Return // If counter ($a0) is equal to 0, finish copying
										ADDI 	$a0, $a0, -4 // Counter lowered 4 bytes
										ADDIU 	$a3, $a3, 4 // Focused 4-byte slot in the flag block address is shifted along 4 bytes
										B 		ReadFlags // Sends back to the loop
										ADDIU 	$a1, $a1, 4 // Shifts the focused 4-byte save slot along 4 bytes

								Return:
									LW 	$ra, @ReturnAddress
									JR 	$ra
									NOP
						</div>
					</div>
					<div class="changelog docbox" asm="variabledisplay">
						<div class="changelog asmHeader">
							Variable Display
						</div>
						<div class="asmcode">
							HijackHelmTimer:
								// The way we are displaying this will be through the helm timer
								// This does sacrifice the display working in Helm in conjunction with the primary helm timer
								// In the future, it would be better to have this working with the timer object (Actor 176)							
								SW 		$ra, @ReturnAddress
								SB 		$r0, 0x80713C9B // Code overwrite to prevent a flag being set to unpause the Helm Timer
								SW 		$r0, 0x80713DE0 // NOP out a line so that helm timeout is prevented
								LBU 	$a0, @VariableDisplayOn // If you want display to be toggleable, store the boolean as a variable
								BEQZ 	$a0, DisplayOff // If you want the variable to not display, skip any formatting
								LUI 	$a3, 0x42FA // Store 125 as a float in the $a3 register
								// Change Helm Timer Format
								LI 		$a0, 0x4C414700 // Encoded ASCII text, must end with "00", so limited to 3 characters. Example here is "LAG"
								SW 		$a0, 0x80759F50 // Store ASCII text as the format for the minutes portion of the Helm Timer
								LI 		$a0, 0x203A2000 // Encoded ASCII text for the delimiter. I would advise " : " (as shown in example)
								SW 		$a0, 0x80759F4C // Store ASCII text as the delimiter portion of the Helm Timer
								LW 		$a0, @VariableValue // Load variable value into $a0 register
								SW 		$a0, @HelmTimerDisplay // Set the displayed Helm Timer value (US: 0x80755348) as your variable value
								LI 		$a0, 1
								SB 		$a0, @HelmTimerShown // Set Helm timer as shown (US: 0x80755350)
								B 		HandleKRoolTimer // Helm timer does collide with the timer in K Rool. Branch to HandleKRoolTimer to solve this
								LUI 	$a3, 0x435C // Store 220 as a float in the $a3 register

								DisplayOff:
									SB 		$r0, @HelmTimerShown // Set Helm timer as hidden (US: 0x80755350)
									LI 		$a0, 0x25326400 // Restore old ASCII (%2d) for minutes section
									SW 		$a0, 0x80759F50 // Store old ASCII for minutes section of the Helm Timer
									LUI		$a0, 0x3A00 // Restore old ASCII (:) for the delimiter section
									SW 		$a0, 0x80759F4C // Store old ASCII for delimiter section of the Helm Timer

								HandleKRoolTimer:
									// K Rool Check
									LW 		$a0, @CurrentMap // Grab current map
									SLTI 	$a1, $a0, 0xCB
									BNEZ 	$a1, Return // If map value is less than 0xCB, you are not in K Rool, therefore you can skip to end
									SLTI 	$a2, $a0, 0xD0
									BEQZ 	$a2, Return // If map value is not less than 0xD0, then you are not in K Rool, and therefore you can skip to end
									NOP
									LW 		$a0, @Player // Load Player Object (US: 0x807FBB4C)
									BEQZ 	$a0, Return // If player object isn't loaded, skip
									NOP
									LW 		$a1, 0x328($a0) // Load pointer located at 0x328 in player (Pointer to K Rool Timer)
									BEQZ 	$a1, Return // If pointer isn't loaded in, skip
									NOP
									SW 		$a3, 0x7C($a1) // Set timer X (Position on screen) as $a3. If the timer is on, we have shifted this to the right

								Return:
									LW 	$ra, @ReturnAddress
									JR 	$ra
									NOP
						</div>
					</div>
					<div class="changelog docbox" asm="isgtimer">
						<div class="changelog asmHeader">
							Turn Intro Story Timer into seconds
						</div>
						<div class="asmcode">
							ConvertISGTimer:
								LBU 	$a1, @ISGActive // Boolean value dictating whether Intro Story is playing (US: 0x80755070)
								BEQZ 	$a1, Return // If intro story not playing, skip any math
								LI 		$a1, 0 // Default time when Intro story not playing
								LD 		$a2, @CurrentTimestamp // Load current timestamp (US: 0x80014FE0)
								LD 		$a1, @ISGTimestamp // Load Intro Story start timestamp (US: 0x807F5CE0)
								DSUBU 	$a1, $a2, $a1 // Get difference between timestamps
								LI 		$a3, @ISGTimer // Load address of temporary storage of doubleword timestamp difference
								SD 		$a1, 0x0($a3) // Store doubleword timestamp difference
								LW 		$a2, 0x0($a3) // Grab major component
								LW 		$a1, 0x4($a3) // Grab minor component
								MTC1 	$a2, $f0 // Transfer major to floating point register $f0
								MTC1 	$a1, $f1 // Transfer minor to floating point register $f1
								CVT.S.W 	$f0, $f0 // Major as float
								CVT.S.W 	$f1, $f1 // Minor as float
								LI 		$a2, 0x4F800000 // 2^32 as float
								MTC1 	$a2, $f6 
								LI 		$a2, 0x41AA7302 // 21.306156 as float
								MTC1 	$a2, $f2
								LI 		$a3, 0x3089705F // 10^-9 as float
								MTC1 	$a3, $f4
								LI 		$a3, 0x42B704BC // If the hex of the minor reads 0x80000000, the float conversion will be negative. Under this scenario, we add an offset to correct this.
								MTC1 	$a3, $f7
								MTC1 	$r0, $f8 // Storing 0 as a float in the floating point register
								MUL.S 	$f0, $f0, $f4 // Major * magnitude
								MUL.S 	$f1, $f1, $f4 // Minor * ticks
								MUL.S 	$f0, $f0, $f2 // Major * magnitude * ticks
								MUL.S 	$f1, $f1, $f2 // Minor * magnitude * ticks
								MUL.S 	$f0, $f0, $f6 // Major * magnitude * ticks * 2^32
								C.LE.S 	$f1, $f8
								BC1F 	AddISGStamps // If minor > 0, then ignore offset correction 
								NOP
								ADD.S 	$f1, $f1, $f7 // Offset correction

							AddISGStamps:
								ADD.S 	$f0, $f0, $f1 // Major + Minor
								LUI 	$a2, 0x3EFF // 0.498 (Close to 0.5). If this was 0.5, then it would cause some frames to round incorrectly
								MTC1 	$a2, $f1
								SUB.S 	$f0, $f0, $f1
								CVT.W.S 	$f0, $f0 // Skip this if you want your timer to remain as a float. This line converts it into an int
								MFC1 	$a1, $f0

							Return:
								// Any method you want to display your ISG timer here
								JR 		$ra
								NOP
						</div>
					</div>
				</div>
			</div>
			<div class="homebox" style="flex:20%">
				<div class="sidebutton_container">
					<button onclick="toggleInfo('feature_list')">
						Feature List
					</button>
				</div>
				<div class="sidebutton_container">
					<button onclick="toggleInfo('installation_guide')">
						Installation Guide
					</button>
				</div>
				<div class="sidebutton_container">
					<button onclick="toggleInfo('trailer')">
						Trailer
					</button>
				</div>
				<div class="sidebutton_container">
					<button onclick="toggleInfo('documentation')">
						Assembler Documentation
					</button>
				</div>
			</div>
		</div>
		<div id="versions_container">

		</div>
	</body>
	<script src="script/nav.js"></script>
	<script>
		var xhttp = new XMLHttpRequest();
		var romData = [];
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				responseJSON = JSON.parse(xhttp.responseText).data;
				romData = responseJSON.versions.slice();
				console.log(romData)
				populate()
				checkParams()
			}
		}
		xhttp.open("GET", "https://raw.githubusercontent.com/theballaam96/theballaam96.github.io/master/data/practicerom_versions.json", true);
		xhttp.send(null)

		function populate() {
			var hook = document.getElementById("versions_container")
			var inverseROMData = romData.slice().reverse()
			inverseROMData.forEach(romVersion => {
				var flex = document.createElement("div")
				flex.classList.add("flexsplitter")

				var box = document.createElement("div")
				box.classList.add("homebox")
				box.classList.add("clickable")
				box.setAttribute("onclick","toggleBox('" + romVersion.version + "')")

				var title_container = document.createElement("div")
				title_container.classList.add("header")
				title_container.classList.add("master_header")

				var strong = document.createElement("strong")
				var strong_text = document.createTextNode("Version " + romVersion.version)
				strong.appendChild(strong_text)
				title_container.appendChild(strong)
				box.appendChild(title_container)

				var togglable_container = document.createElement("div")
				togglable_container.classList.add("toggleable")
				togglable_container.setAttribute("tiedVersion",romVersion.version)
				togglable_container.classList.add("hide")
				togglable_container.setAttribute("id",romVersion.version)

				// Changelog
				var changelog_container = document.createElement("div")
				changelog_container.classList.add("changelog")
				changelog_container.classList.add("container")
				
				// Changelog Version
				var changelog_version = document.createElement("div")
				changelog_version.classList.add("changelog")
				changelog_version.classList.add("version")
				var changelog_version_text = document.createTextNode("Version " + romVersion.version)
				changelog_version.appendChild(changelog_version_text)
				changelog_container.appendChild(changelog_version)

				// Changelog Date
				var changelog_date = document.createElement("div")
				changelog_date.classList.add("changelog")
				changelog_date.classList.add("date")
				var changelog_date_text = document.createTextNode("Release Date: " + romVersion.release_date)
				changelog_date.appendChild(changelog_date_text)
				changelog_container.appendChild(changelog_date)
				
				// Changelog Warning, if applicable (Regarding text changes)
				if (romVersion.lunar_warning) {
					var changelog_warning = document.createElement("div")
					changelog_warning.classList.add("changelog")
					changelog_warning.classList.add("warning")
					var changelog_warning_text = document.createTextNode("This version will not display text changes with the Lunar IPS patch")
					changelog_warning.appendChild(changelog_warning_text)
					changelog_container.appendChild(changelog_warning)
				}

				// Changelog Changes
				var changelog_ul = document.createElement("ul")
				changelog_ul.classList.add("changelog")
				changelog_ul.classList.add("_ul")
				romVersion.changelog.forEach(change => {
					var changelog_li = document.createElement("li")
					changelog_li.classList.add("changelog")
					changelog_li.classList.add("_li")
					var changelog_li_text = document.createTextNode(change)
					changelog_li.appendChild(changelog_li_text)
					changelog_ul.appendChild(changelog_li)
				})
				changelog_container.appendChild(changelog_ul)
				togglable_container.appendChild(changelog_container)

				// Buttons
				var buttons_container = document.createElement("div")
				buttons_container.style.display = "flex";

				// Beat
				var container_beat = document.createElement("div")
				container_beat.classList.add("buttoncontainer")
				var button_beat = document.createElement("button")
				button_beat.setAttribute("onclick", "visit('beat','" + romVersion.version + "')")
				var text_beat = document.createTextNode("Download (Beat)")
				button_beat.appendChild(text_beat)
				container_beat.appendChild(button_beat)
				buttons_container.appendChild(container_beat)

				// Lunar
				if (romVersion.lunar != "") {
					var container_lunar = document.createElement("div")
					container_lunar.classList.add("buttoncontainer")
					var button_lunar = document.createElement("button")
					button_lunar.setAttribute("onclick", "visit('lunar','" + romVersion.version + "')")
					var text_lunar = document.createTextNode("Download (Lunar IPS)")
					button_lunar.appendChild(text_lunar)
					container_lunar.appendChild(button_lunar)
					buttons_container.appendChild(container_lunar)
				}

				// Web Patcher
				var container_webpatcher = document.createElement("div")
				container_webpatcher.classList.add("buttoncontainer")
				var button_webpatcher = document.createElement("button")
				button_webpatcher.setAttribute("onclick", "visit('web','" + romVersion.version + "')")
				var text_webpatcher = document.createTextNode("Download (Web Patcher)")
				button_webpatcher.appendChild(text_webpatcher)
				container_webpatcher.appendChild(button_webpatcher)
				buttons_container.appendChild(container_webpatcher)

				// Source
				var container_source = document.createElement("div")
				container_source.classList.add("buttoncontainer")
				var button_source = document.createElement("button")
				button_source.setAttribute("onclick", "visit('source','" + romVersion.version + "')")
				var text_source = document.createTextNode("View Source Code")
				button_source.appendChild(text_source)
				container_source.appendChild(button_source)
				buttons_container.appendChild(container_source)

				togglable_container.appendChild(buttons_container)
				box.appendChild(togglable_container)
				flex.appendChild(box)
				hook.appendChild(flex)
			})
		}

		function checkParams() {
			var queryString = window.location.search;
			const urlParams = new URLSearchParams(queryString)
			const versionnum = urlParams.get("version");
			console.log("Detected Version: " + versionnum)
			toggleBox(versionnum)
		}

		function goTo(url) {
			window.location.href = url
		}

		function visit(linkType, version) {
			var toggleBoxes = document.getElementsByClassName("toggleable")
			for (i = 0; i < toggleBoxes.length; i++) {
				var focusId = toggleBoxes[i].getAttribute("tiedVersion")
				if (focusId == version) {
					toggleBoxes[i].classList.add("hide")
				}
			}
			if (linkType != "web") {
				var focusObj = romData.find(item => item.version == version)
				var url = focusObj[linkType]
			} else {
				var url = "https://patch.wedarobi.com/dk_practice_rom";
			}

			goTo(url)
		}

		function toggleBox(indic) {
			var toggleBoxes = document.getElementsByClassName("toggleable")
			for (i = 0; i < toggleBoxes.length; i++) {
				var focusId = toggleBoxes[i].getAttribute("tiedVersion")
				if (focusId == indic) {
					toggleBoxes[i].classList.toggle("hide")
				}
			}
		}

		function toggleInfo(indic) {
			var toggleBoxes = document.getElementsByClassName("infoContainer")
			for (i = 0; i < toggleBoxes.length; i++) {
				var focusId = toggleBoxes[i].getAttribute("box")
				if (focusId == indic) {
					toggleBoxes[i].classList.remove("hide")
				} else {
					toggleBoxes[i].classList.add("hide")
				}
			}
		}

		function formatASMCode() {
			var codeBlocks = document.getElementsByClassName("asmcode")
			for (i = 0; i < codeBlocks.length; i++) {
				var init = codeBlocks[i].innerHTML;
				var init_array = init.split("\n").filter(item => item != "").map(item => item.trim())
				var codeAsObjs = []
				init_array.forEach(line => {
					var splitLine = line.split("	").filter(item => item != "").map(item => item.trim())
					var isLabel = line.substring(line.length - 1) == ":"
					var isComment = line.substring(0,2) == "//"
					if (splitLine.length == 2) {
						var commentLocation = splitLine[1].indexOf("//") - 1
						var nonFunc = [];
						if (commentLocation > -2) {
							nonFunc = [splitLine[1].substring(0,commentLocation),splitLine[1].substring(commentLocation)]
						} else {
							nonFunc = [splitLine[1]]
						}
						//nonFunc[0] = nonFunc[0].split(", ")
						splitLine = [splitLine[0],nonFunc]
					}
					var lineType = ""
					var funcList = {}
					var isAlign = false;
					if (line == ".align") {
						isAlign = true;
					}
					if (isLabel) {
						lineType = "label"
					} else if (isComment) {
						lineType = "comment"
					} else if (isAlign) {
						lineType = "align"
					} else {
						lineType = "func"
						var paramsLine = []
						var commentLine = ""
						if (splitLine[1]) {
							if (splitLine[1][0]) {
								paramsLine = splitLine[1][0].split(", ")
								commentLine = splitLine[1][1]
							} else {
								paramsLine = splitLine[1].split(", ")
							}
						}
						funcList = {
							"func": splitLine[0],
							"params": paramsLine,
							"comment": commentLine,
						}
					}
					if (line != "") {
						codeAsObjs.push({
							"fullLine": line,
							"lineType": lineType,
							"funcDetails": funcList,

						})
					}
				})
				console.log(codeAsObjs)
				codeBlocks[i].innerHTML = ""
				var preTag = document.createElement("pre")
				var codeTag = document.createElement("code")
				var indentLevel = 0;
				codeAsObjs.forEach(line => {
					if (line.lineType == "label") {
						if (indentLevel > 0) {
							var codePad = document.createElement("div")
							codePad.classList.add("asm")
							codePad.classList.add("pad")
							codeTag.appendChild(codePad)
						}
						if (indentLevel > 1) {
							indentLevel = 1;
						}
					}
					if (line.lineType == "align") {
						var codePad = document.createElement("div")
						codePad.classList.add("asm")
						codePad.classList.add("pad")
						codeTag.appendChild(codePad)
						indentLevel = 0
					}
					var codeContainer = document.createElement("div")
					var indentPad = (20 * indentLevel) + "px"
					codeContainer.style["padding-left"] = indentPad
					if (line.lineType == "label" || line.lineType == "align") {
						var span = document.createElement("span")
						span.classList.add("asm")
						span.classList.add("label")
						var spanText = document.createTextNode(line.fullLine)
						// Cleanup
						if (line.lineType == "label") {
							indentLevel += 1;
						} else {
							indentLevel = 0;
						}
						span.appendChild(spanText)
						codeContainer.appendChild(span)
					}
					if (line.lineType == "comment") {
						var span = document.createElement("span")
						span.classList.add("asm")
						span.classList.add("comment")
						var spanText = document.createTextNode(line.fullLine)
						// Cleanup
						span.appendChild(spanText)
						codeContainer.appendChild(span)
					}
					if (line.lineType == "func") {
						// Function
						var spanFunc = document.createElement("span")
						spanFunc.classList.add("asm")
						spanFunc.classList.add("func")
						var spanFuncText = document.createTextNode(line.funcDetails.func)
						// Function Cleanup
						spanFunc.appendChild(spanFuncText)
						codeContainer.appendChild(spanFunc)

						// Parameters
						if (line.funcDetails.params) {
							line.funcDetails.params.forEach((param, index) => {
								var splitParam = param.split("(")
								var spanParam = document.createElement("span")
								spanParam.classList.add("asm")
								if (splitParam[0].substring(0,1) == "-" || !isNaN(parseInt(splitParam[0].substring(0,1)))) {
									spanParam.classList.add("hex")
								} else if (splitParam[0].substring(0,1) == "@") {
									spanParam.classList.add("pointer")
								} else if (splitParam[0].substring(0,1) == "$") {
									spanParam.classList.add("param")
								} else {
									spanParam.classList.add("array")
								}
								if (index == 0) {
									spanParam.classList.add("first")
									var funcLength = line.funcDetails.func.length
									var paramOffset = (7 - funcLength) * 7
									spanParam.style["margin-left"] = paramOffset + "px"
								}
								var spanParamText = document.createTextNode(splitParam[0])
								// Cleanup
								spanParam.appendChild(spanParamText)
								codeContainer.appendChild(spanParam)
								if (splitParam.length > 1) {
									// Open Bracket
									var spanOpenBracket = document.createElement("span")
									spanOpenBracket.classList.add("asm")
									spanOpenBracket.classList.add("delimiter")
									var spanOpenBracketText = document.createTextNode(" (")
									// Cleanup
									spanOpenBracket.appendChild(spanOpenBracketText)
									codeContainer.appendChild(spanOpenBracket)
									// Bracketed Param
									var innerParam = splitParam[1].substring(0, splitParam[1].length - 1)
									var spanInnerParam = document.createElement("span")
									spanInnerParam.classList.add("asm")
									spanInnerParam.classList.add("param")
									var spanInnerParamText = document.createTextNode(innerParam)
									// Cleanup
									spanInnerParam.appendChild(spanInnerParamText)
									codeContainer.appendChild(spanInnerParam)
									// Close Bracket
									var spanCloseBracket = document.createElement("span")
									spanCloseBracket.classList.add("asm")
									spanCloseBracket.classList.add("delimiter")
									var spanCloseBracketText = document.createTextNode(")")
									// Cleanup
									spanCloseBracket.appendChild(spanCloseBracketText)
									codeContainer.appendChild(spanCloseBracket)
								}

								// Comma Check
								if (index != line.funcDetails.params.length - 1) {
									var spanComma = document.createElement("span")
									spanComma.classList.add("asm")
									spanComma.classList.add("delimiter")
									var spanCommaText = document.createTextNode(", ")
									// Cleanup
									spanComma.appendChild(spanCommaText)
									codeContainer.appendChild(spanComma)
								}
							})

							// Comment
							if (line.funcDetails.comment) {
								var spanComment = document.createElement("span")
								spanComment.classList.add("asm")
								spanComment.classList.add("comment")
								var spanCommentText = document.createTextNode(line.funcDetails.comment)
								// Cleanup
								spanComment.appendChild(spanCommentText)
								codeContainer.appendChild(spanComment)
							}
						}
						
						
					}
					codeTag.appendChild(codeContainer)
				})
				preTag.appendChild(codeTag)
				codeBlocks[i].appendChild(preTag)
			}
		}
		formatASMCode()
		//document.getElementsByClassName("navbar")[0].getElementsByTagName("ul")[0].innerHTML = ""
	</script>
</html>